{% load static %}
<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{% block title %}JoyScore{% endblock %}</title> 
    
    <link rel="stylesheet" href="{% static 'jogos/css/style.css' %}">
    <link rel="stylesheet" href="{% static 'jogos/css/light-theme.css' %}" disabled id="light-theme-style">
    
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css">
    
    <style>
        .header {
            position: relative; 
            z-index: 1000; 
        }
    </style>
    {% block extra_css %}
    {% endblock %}
    
</head>
<body data-theme="dark">
    <header class="header">
        <div class="logo-container">
            <a href="{% url 'jogos:home' %}" class="logo-link">
                <img src="{% static 'jogos/imagens/logo.png' %}"
                     alt="JoyScore"
                     class="logo-img"
                     style="display:block; max-width:220px; max-height:72px; width:auto; height:auto;">
            </a>
        </div>

        {% if request.resolver_match.url_name == 'home' %}
        <div class="search-filter-container">
            <div class="header-search">
                <input type="text" id="game-search-input" placeholder="Pesquisar jogo...">
                <div id="autocomplete-results"></div>
            </div>
            <div class="header-filter-link">
                <a href="{% url 'jogos:filtrar_por_genero' %}" class="filter-toggle-button">
                    <i class="fas fa-filter"></i> Filtrar Gêneros
                </a>
            </div>
        </div>
        {% endif %}
        <div class="right-section">
            
            {% if request.resolver_match.url_name == 'home' and user.is_authenticated %}
                <a href="{% url 'jogos:configuracoes_conta' %}" class="header-avatar-link">
                    {% if profile.avatar %}
                        <img src="{% static profile.avatar %}" alt="Avatar" class="header-avatar-img">
                    {% else %}
                        <img src="{% static 'jogos/imagens/avatar1.png' %}" alt="Avatar Padrão" class="header-avatar-img">
                    {% endif %}
                </a>
            {% endif %}

            <input type="checkbox" id="menu-toggle" hidden>
            <label for="menu-toggle" class="hamburger">
                <div></div>
                <div></div>
                <div></div>
            </label>
            <nav class="menu">
                <ul>
                    <li><a href="{% url 'jogos:home' %}">Início</a></li>
                    <li><a href="{% url 'jogos:minha_biblioteca' %}">Biblioteca</a></li>
                    <li><a href="{% url 'jogos:avaliacoes_comunidade' %}">Avaliações da Comunidade</a></li>
                    <li><a href="{% url 'jogos_steam:steam_tac_toe' %}">Steam Tac Toe</a></li>
                    <li><a href="{% url 'jogos_steam:whats_my_score' %}">What's My Score</a></li> 
                    <li><a href="{% url 'jogos:configuracoes_conta' %}">Configurações de Conta</a></li>
                </ul>
            </nav>
        </div>
    </header>

    <main class="main-content">
        
        {% if messages %}
            <div class="messages-container">
                {% for message in messages %}
                    <div class="message {{ message.tags }}">
                        {{ message }}
                        <span class="close-message-btn" onclick="this.parentElement.style.display='none'">&times;</span>
                    </div>
                {% endfor %}
            </div>
        {% endif %}

        {% block content %}
        {% endblock %}
    </main>

    <footer>
        <p>&copy; 2025-JoyScore</p>
    </footer>

    <script>
        const themeToggleBtn = document.getElementById('theme-toggle');

        if (themeToggleBtn) {
            themeToggleBtn.addEventListener('click', (event) => {
                event.preventDefault(); 
                const currentTheme = document.body.getAttribute('data-theme');
                const newTheme = currentTheme === 'dark' ? 'light' : 'dark';
                applyTheme(newTheme);
            });
        }

        const lightThemeStyle = document.getElementById('light-theme-style');
        const body = document.body;
        const themeIcon = document.getElementById('theme-icon');
        const themeText = document.getElementById('theme-text');

        function applyTheme(theme) {
            if (theme === 'light') {
                body.setAttribute('data-theme', 'light');
                lightThemeStyle.disabled = false;
                if (themeIcon) themeIcon.className = 'fas fa-moon'; 
                if (themeText) themeText.textContent = 'Modo Escuro'; 
            } else {
                body.setAttribute('data-theme', 'dark');
                lightThemeStyle.disabled = true;
                if (themeIcon) themeIcon.className = 'fas fa-sun'; 
                if (themeText) themeText.textContent = 'Modo Branco'; 
            }
            localStorage.setItem('theme', theme);
        }

        document.addEventListener('DOMContentLoaded', () => {
            const savedTheme = localStorage.getItem('theme') || 'dark'; 
            applyTheme(savedTheme);
        });
    </script>

    
    <script>
        document.addEventListener('DOMContentLoaded', () => {
            if (!window.location.pathname.includes('steam-tac-toe')) {
                localStorage.removeItem('p1Score');
                localStorage.removeItem('p2Score');
            }
        });
    </script>
    
    <script>
    document.addEventListener('DOMContentLoaded', () => {
        const menuToggle = document.getElementById('menu-toggle');
        const hamburger = document.querySelector('label[for="menu-toggle"]'); 
        const menu = document.querySelector('.menu');

        if (menuToggle && hamburger && menu) {
            
            // Usamos 'mousedown' pois ele ocorre ANTES do 'click'
            // que ativa o <label>
            document.addEventListener('mousedown', function(event) {
                
                // 1. Se o menu está fechado, nosso script não faz nada.
                if (!menuToggle.checked) {
                    return;
                }

                // 2. Verifica se o clique foi no hamburguer ou dentro do menu
                const clickedOnHamburger = hamburger.contains(event.target);
                const clickedInsideMenu = menu.contains(event.target);

                // 3. Se o clique foi FORA de ambos
                if (!clickedOnHamburger && !clickedInsideMenu) {
                    // Nós fechamos o menu.
                    // Isso acontece antes do 'click' ser registrado,
                    // então não há conflito.
                    menuToggle.checked = false;
                }
            });
        }
    });
    </script>
    {% block extra_scripts %}
    {% endblock %}

</body>
</html>