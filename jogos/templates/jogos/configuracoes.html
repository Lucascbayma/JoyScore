{% extends 'base.html' %}
{% load static %}

{% block title %}Configurações de Conta - JoyScore{% endblock %}

{% block extra_css %}
    <link rel="stylesheet" href="{% static 'jogos/css/configuracoes.css' %}">
{% endblock %}

{% block content %}
<main class="main-content">
    <section class="content-section">
        <div class="section-header">
            <h2 class="section-title">Configurações de Conta</h2>
        </div>

        <div class="config-card profile-info">
            <h3 class="card-title">Informações do Usuário</h3>
            <p class="user-display">
                Bem-vindo, <span class="username-highlight">{{ user.username }}</span>.
            </p>
        </div>

        <div class="config-card genre-preferences-card">
            
            {% if profile.generos_favoritos and not 'edit' in request.GET %}
                
                <div class="preferences-header">
                    <h3 class="card-title">Seus Gêneros Favoritos</h3>
                    <a href="?edit=true" class="edit-button">Alterar Preferências</a>
                </div>
                <div class="genre-container-display">
                    {% for genre_name in profile.generos_favoritos %}
                        <span class="genre-tag">{{ genre_name }}</span>
                    {% endfor %}
                </div>

            {% else %}

                <form method="POST" action="{% url 'jogos:configuracoes_conta' %}">
                    {% csrf_token %}
                    <h3 class="card-title">Gêneros Favoritos</h3>
                    <p class="preference-instructions">Selecione os gêneros que você mais gosta.</p>
                    
                    <div class="genre-container-config">
                        {% for genre in all_genres %}
                            <div class="genre-item-config">
                                <input type="checkbox" name="genres" class="genre-checkbox" value="{{ genre.name }}" id="pref-{{ genre.slug }}"
                                       {% if genre.name in profile.generos_favoritos %}checked{% endif %}>
                                <label for="pref-{{ genre.slug }}">{{ genre.name }}</label>
                            </div>
                        {% endfor %}
                    </div>
                    <button type="submit" class="save-button" id="save-prefs-button" disabled>Salvar Preferências</button>
                </form>

            {% endif %}
        </div>
        
        <div class="config-card theme-settings-card">
            <h3 class="card-title">Configuração de Tema</h3>
            <p class="info-text">Alterne entre o tema escuro e o tema claro para uma melhor experiência visual.</p>
            <a href="#" id="theme-toggle" class="theme-toggle-button">
                <i class="fas fa-moon" id="theme-icon"></i><span id="theme-text">Modo Branco</span>
            </a>
        </div>
        
    </section>
</main>
{% endblock %}

{% block extra_scripts %}
<script>
document.addEventListener('DOMContentLoaded', function() {
    const saveButton = document.getElementById('save-prefs-button');
    const checkboxes = document.querySelectorAll('.genre-checkbox');

    // Função que verifica o estado dos checkboxes e atualiza o botão
    function updateButtonState() {
        // Conta quantos checkboxes estão marcados
        const checkedCount = document.querySelectorAll('.genre-checkbox:checked').length;
        
        // Se a contagem for 0, desabilita o botão. Caso contrário, habilita.
        if (checkedCount === 0) {
            saveButton.disabled = true;
        } else {
            saveButton.disabled = false;
        }
    }

    // Adiciona um "ouvinte" a cada checkbox.
    // Toda vez que um for clicado, a função updateButtonState é chamada.
    checkboxes.forEach(checkbox => {
        checkbox.addEventListener('change', updateButtonState);
    });

    // Chama a função uma vez no início para definir o estado inicial correto do botão.
    // Isso garante que se o usuário já tiver preferências salvas, o botão comece habilitado.
    if(saveButton) {
        updateButtonState();
    }
});
</script>
{% endblock %}